<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Sửa Hóa Đơn</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
    <style>
        .form-container { max-width: 600px; margin: 20px auto; }
        .error-message { color: #dc3545; font-size: 0.85em; margin-top: -5px; margin-bottom: 10px; display: block;}
        input.error { border-color: #dc3545; }
        input:read-only, input[readonly] { background-color: #e9ecef; color: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>
    <div th:replace="~{fragments/_header :: header}"></div>

    <div class="container form-container">
        <h1>Sửa Hóa Đơn</h1>

        <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

        <form th:action="@{/hoadon/sua/luu}" th:object="${hoaDon}" method="post">
            
            <div th:if="${#fields.hasAnyErrors()}" class="alert alert-danger">
                Vui lòng sửa các lỗi dưới đây.
            </div>

            <input type="hidden" th:field="*{id}" />
            
            <div>
                <label for="id_display">ID Hóa Đơn:</label>
                <input type="text" id="id_display" th:value="*{id}" readonly />
            </div>
            <div>
                <label for="ngayTao">Ngày Tạo:</label>
                <input type="text" id="ngayTao" th:value="${#temporals.format(hoaDon.ngayTao, 'dd/MM/yyyy HH:mm:ss')}" readonly />
            </div>
            <div>
                <label for="tongTien">Tổng Tiền:</label>
                <input type="text" id="tongTien" th:value="${#numbers.formatDecimal(hoaDon.tongTien, 1, 'COMMA', 2, 'POINT')}" readonly />
            </div>

            <hr style="margin: 20px 0;"/>

            <div>
                <label for="tenKhachHang">Tên Khách Hàng:</label>
                <input type="text" id="tenKhachHang" th:field="*{tenKhachHang}" th:classappend="${#fields.hasErrors('tenKhachHang')} ? 'error' : ''" />
                <span class="error-message" th:if="${#fields.hasErrors('tenKhachHang')}" th:errors="*{tenKhachHang}"></span>
            </div>

            <div class="form-actions">
                <button type="submit">Lưu Thay Đổi</button>
                <a th:href="@{/hoadon}" class="button-secondary">Hủy</a>
            </div>
        </form>
    </div>
</body>
</html>